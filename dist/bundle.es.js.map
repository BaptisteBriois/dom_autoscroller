{"version":3,"file":null,"sources":["../src/index.js"],"sourcesContent":["import createPointCB from 'create-point-cb';\n\nconst requestFrame = (function(){\n    if(requestAnimationFrame){\n        return requestAnimationFrame;\n    }else{\n        return function(fn){\n            return setTimeout(fn);\n        };\n    }\n}());\n\nconst cancelFrame = (function(){\n    if(cancelAnimationFrame){\n        return cancelAnimationFrame;\n    }else{\n        return clearTimeout;\n    }\n}());\n\nfunction AutoScroller(elements, options = {}){\n    const self = this;\n    let maxSpeed = 4;\n\n    this.margin = options.margin || -1;\n    this.scrolling = false;\n    this.scrollWhenOutside = options.scrollWhenOutside || false;\n\n    let point = {}, pointCB = createPointCB(point), down = false;\n\n    window.addEventListener('mousemove', pointCB, false);\n    window.addEventListener('touchmove', pointCB, false);\n\n    if(!isNaN(options.maxSpeed)){\n        maxSpeed = options.maxSpeed;\n    }\n\n    if(typeof options.autoScroll === 'boolean'){\n        this.autoScroll = options.autoScroll ? ()=>true : ()=>false;\n    }else if(typeof options.autoScroll === 'undefined'){\n        this.autoScroll = function(){return false;};\n    }else if(typeof options.autoScroll === 'function'){\n        this.autoScroll = options.autoScroll;\n    }\n\n    this.destroy = function() {\n        window.removeEventListener('mousemove', pointCB, false);\n        window.removeEventListener('touchmove', pointCB, false);\n        window.removeEventListener('mousedown', onDown, false);\n        window.removeEventListener('touchstart', onDown, false);\n        window.removeEventListener('mouseup', onUp, false);\n        window.removeEventListener('touchend', onUp, false);\n        elements = [];\n    };\n\n    function getElement(element){\n        if(typeof element === 'string'){\n            return document.querySelector(element);\n        }\n        return element;\n    }\n\n    this.add = function(element){\n        element = getElement(element);\n\n        for(var i=0; i<elements.length; i++){\n            if(elements[i] === element) return this;\n        }\n\n        elements.push(element);\n        return this;\n    };\n\n    this.remove = function(element){\n        element = getElement(element);\n\n        for(var i=0; i<elements.length; i++){\n            if(element === elements[i]){\n                elements.splice(i, 1);\n                return this;\n            }\n        }\n        return this;\n    };\n\n    let hasWindow = null, windowAnimationFrame;\n\n    (function(temp){\n        elements = [];\n        temp.forEach(function(element){\n            if(element === window){\n                hasWindow = window;\n            }else{\n                self.add(element);\n            }\n        })\n    }(elements));\n\n    Object.defineProperties(this, {\n        down: {\n            get: function(){ return down; }\n        },\n        maxSpeed: {\n            get: function(){ return maxSpeed; }\n        }\n    });\n\n    let n = 0, current = null, animationFrame;\n\n    window.addEventListener('mousedown', onDown, false);\n    window.addEventListener('touchstart', onDown, false);\n    window.addEventListener('mouseup', onUp, false);\n    window.addEventListener('touchend', onUp, false);\n\n    window.addEventListener('mousemove', onMove, false);\n    window.addEventListener('touchmove', onMove, false);\n\n    window.addEventListener('mouseleave', onMouseOut, false);\n\n    function onDown(){\n        down = true;\n    }\n\n    function onUp(){\n        down = false;\n        cancelFrame(animationFrame);\n        cancelFrame(windowAnimationFrame)\n    }\n\n    function onMouseOut(){\n        down = false;\n    }\n\n    function getTarget(target){\n        if(!target){\n            return null;\n        }\n\n        if(current === target){\n            return target;\n        }\n\n        for(var i=0; i<elements.length; i++){\n            if(elements[i] === target){\n                return target;\n            }\n        }\n\n        while(target = target.parentNode){\n            for(var i=0; i<elements.length; i++){\n                if(elements[i] === target){\n                    return target;\n                }\n            }\n        }\n\n        return null;\n    }\n\n    function getElementUnderPoint(){\n        let underPoint = null;\n\n        for(var i=0; i<elements.length; i++){\n            if(inside(point, elements[i])){\n                underPoint = elements[i];\n            }\n        }\n\n        return underPoint;\n    }\n\n\n    function onMove(event){\n\n        if(!self.autoScroll()) return;\n        let target = event.target, body = document.body;\n\n        if(current && !inside(point, current)){\n            if(!self.scrollWhenOutside){\n                current = null;\n            }\n        }\n\n        if(target && target.parentNode === body){\n            //The special condition to improve speed.\n            target = getElementUnderPoint();\n        }else{\n            target = getTarget(target);\n\n            if(!target){\n                target = getElementUnderPoint();\n            }\n            /*if(target){\n                current = target;\n            }else{\n                //The target might have still been moved.\n                current = getElementUnderPoint();\n            }*/\n        }\n\n\n        //current = target;\n        if(target && target !== current){\n            current = target;\n        }\n\n        if(hasWindow){\n            cancelFrame(windowAnimationFrame);\n            windowAnimationFrame = requestFrame(scrollWindow);\n        }\n\n\n        if(!current){\n            return;\n        }\n\n        cancelFrame(animationFrame);\n        animationFrame = requestFrame(scrollTick);\n    }\n\n    function scrollWindow(){\n        autoScroll(hasWindow);\n\n        cancelFrame(windowAnimationFrame);\n        windowAnimationFrame = requestFrame(scrollWindow);\n    }\n\n    function scrollTick(){\n\n        if(!current){\n            return;\n        }\n\n        autoScroll(current);\n\n        cancelFrame(animationFrame);\n        animationFrame = requestFrame(scrollTick);\n\n    }\n\n    function autoScroll(el){\n        let rect = getRect(el), scrollx, scrolly;\n\n        if(point.x < rect.left + self.margin){\n            scrollx = Math.floor(\n                Math.max(-1, (point.x - rect.left) / self.margin - 1) * self.maxSpeed\n            );\n        }else if(point.x > rect.right - self.margin){\n            scrollx = Math.ceil(\n                Math.min(1, (point.x - rect.right) / self.margin + 1) * self.maxSpeed\n            );\n        }else{\n            scrollx = 0;\n        }\n\n        if(point.y < rect.top + self.margin){\n            scrolly = Math.floor(\n                Math.max(-1, (point.y - rect.top) / self.margin - 1) * self.maxSpeed\n            );\n        }else if(point.y > rect.bottom - self.margin){\n            scrolly = Math.ceil(\n                Math.min(1, (point.y - rect.bottom) / self.margin + 1) * self.maxSpeed\n            );\n        }else{\n            scrolly = 0;\n        }\n\n        setTimeout(()=>{\n\n            if(scrolly){\n                scrollY(el, scrolly);\n            }\n\n            if(scrollx){\n                scrollX(el, scrollx);\n            }\n\n        });\n    }\n\n    function scrollY(el, amount){\n        if(el === window){\n            window.scrollTo(el.pageXOffset, el.pageYOffset + amount);\n        }else{\n            //el.scrollTop = el.scrollTop + amount;\n            el.scrollTop += amount;\n        }\n    }\n\n    function scrollX(el, amount){\n        if(el === window){\n            window.scrollTo(el.pageXOffset + amount, el.pageYOffset);\n        }else{\n            //el.scrollLeft = el.scrollLeft + amount;\n            el.scrollLeft += amount;\n        }\n    }\n\n}\n\nexport default function AutoScrollerFactory(element, options){\n    return new AutoScroller(element, options);\n}\n\nfunction getRect(el){\n    if(el === window){\n        return {\n            top: 0,\n            left: 0,\n            right: window.innerWidth,\n            bottom: window.innerHeight,\n            width: window.innerWidth,\n            height: window.innerHeight\n        };\n\n    }else{\n        try{\n            return el.getBoundingClientRect();\n        }catch(e){\n            throw new TypeError(\"Can't call getBoundingClientRect on \"+el);\n        }\n\n    }\n}\n\nfunction inside(point, el, rect){\n    rect = rect || getRect(el);\n    return (point.y > rect.top && point.y < rect.bottom &&\n            point.x > rect.left && point.x < rect.right);\n}\n\n/*\ngit remote add origin https://github.com/hollowdoor/dom_autoscroller.git\ngit push -u origin master\n*/\n"],"names":["requestFrame","requestAnimationFrame","fn","setTimeout","cancelFrame","cancelAnimationFrame","clearTimeout","AutoScroller","elements","options","self","maxSpeed","margin","scrolling","scrollWhenOutside","point","pointCB","createPointCB","down","addEventListener","isNaN","autoScroll","destroy","removeEventListener","onDown","onUp","getElement","element","document","querySelector","add","i","length","push","remove","splice","hasWindow","windowAnimationFrame","temp","forEach","window","defineProperties","n","current","animationFrame","onMove","onMouseOut","getTarget","target","parentNode","getElementUnderPoint","underPoint","inside","event","body","scrollWindow","scrollTick","el","rect","getRect","scrollx","scrolly","x","left","Math","floor","max","right","ceil","min","y","top","bottom","scrollY","amount","scrollTo","pageXOffset","pageYOffset","scrollTop","scrollX","scrollLeft","AutoScrollerFactory","innerWidth","innerHeight","getBoundingClientRect","e","TypeError"],"mappings":"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"}